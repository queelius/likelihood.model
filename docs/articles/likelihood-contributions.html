<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Likelihood contributions model • likelihood.model</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Likelihood contributions model">
<meta property="og:description" content="likelihood.model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">likelihood.model</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/likelihood-contributions.html">Likelihood contributions model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/queelius/likelihood.model/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="likelihood-contributions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Likelihood contributions model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/queelius/likelihood.model/blob/HEAD/vignettes/likelihood-contributions.Rmd" class="external-link"><code>vignettes/likelihood-contributions.Rmd</code></a></small>
      <div class="hidden name"><code>likelihood-contributions.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>likelihood.model</code> from <a href="https://github.com/queelius/likelihood.model" class="external-link">GitHub</a> with:</p>
<pre><code><span><span class="co">#&gt; Loading required package: devtools</span></span>
<span><span class="co">#&gt; Loading required package: usethis</span></span>
<span><span class="co">#&gt; Loading required package: algebraic.mle</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'algebraic.dist':</span></span>
<span><span class="co">#&gt;   method     from </span></span>
<span><span class="co">#&gt;   print.dist stats</span></span>
<span><span class="co">#&gt; Loading required package: likelihood.model</span></span></code></pre>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/queelius/algebraic.mle" class="external-link">algebraic.mle</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/queelius/likelihood.model" class="external-link">likelihood.model</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exponential-series-system">Exponential series system<a class="anchor" aria-label="anchor" href="#exponential-series-system"></a>
</h2>
<p>Consider a series system with <span class="math inline">\(m\)</span> components, where the <span class="math inline">\(p\)</span>th component in the <span class="math inline">\(i\)</span>-th system has lifetime <span class="math inline">\(T_{i p}\)</span> with rate <span class="math inline">\(\lambda_p\)</span>, and <span class="math inline">\(T_{i j}\)</span> for all <span class="math inline">\(i,j\)</span> are independent. The system lifetime is the minimum of the component lifetimes, i.e., <span class="math inline">\(T_i = \min\{T_{i 1}, \ldots, T_{i m}\}\)</span>.</p>
<p>Let’s draw a sample for this model for <span class="math inline">\(m=3\)</span> and <span class="math inline">\(\lambda = (1.1, 1.2, 1.3)\)</span> for a sample size of <span class="math inline">\(n=90\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">1.2</span>, <span class="fl">1.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1235</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">rates</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 t2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">rates</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 t3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">rates</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">min</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># map each observation to the corresponding index (component) that was minimum</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">which.min</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">p</span> <span class="op">==</span> <span class="va">df</span><span class="op">$</span><span class="va">k</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="kw">next</span></span>
<span>        <span class="va">df</span><span class="op">[</span><span class="va">i</span>, <span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;       t1     t2    t3      t k</span></span>
<span><span class="co">#&gt; 1     NA 0.3201    NA 0.3201 2</span></span>
<span><span class="co">#&gt; 2     NA 0.0449    NA 0.0449 2</span></span>
<span><span class="co">#&gt; 3     NA 0.0488    NA 0.0488 2</span></span>
<span><span class="co">#&gt; 4 0.0827     NA    NA 0.0827 1</span></span>
<span><span class="co">#&gt; 5     NA     NA 0.141 0.1408 3</span></span>
<span><span class="co">#&gt; 6 0.0347     NA    NA 0.0347 1</span></span></code></pre></div>
<p>Column <span class="math inline">\(t_k\)</span> is the failure time of the <span class="math inline">\(k\)</span>-th component, column <span class="math inline">\(t\)</span> is the column for the series system lifetime, the same as <span class="math inline">\(t_k\)</span>, and column <span class="math inline">\(k\)</span> is the component that caused the system failure.</p>
<p>We see that the component cause of failure is observed and the other component lifetimes are not observed (NA).</p>
<p>In what follows, we consider two cases of masking or censoring, or otherwise <em>incomplete data</em> of some form.</p>
<ol style="list-style-type: decimal">
<li><p>We know the system lifetime and the component cause of failure. (Columns <span class="math inline">\(t\)</span> and <span class="math inline">\(k\)</span> are observed.</p></li>
<li><p>We observe a system lifetime with a right-censoring mechanism and the component cause of failure.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="case-1-observed-system-failure-time-and-component-cause-of-failure">Case 1: Observed system failure time and component cause of failure<a class="anchor" aria-label="anchor" href="#case-1-observed-system-failure-time-and-component-cause-of-failure"></a>
</h2>
<p>Suppose we have a series system. As a series system, whenever a component fails, the system fails, and thus the system lifetime is equal to the minimum of the component lifetimes.</p>
<p>Suppose the component lifetimes are exponentially distributed with rate <span class="math inline">\(\lambda_k\)</span> for component <span class="math inline">\(k\)</span>.</p>
<p>In this case, we assume we can observe the system lifetime and the component that caused the system failure, which means we know a few things about each system in the sample:</p>
<ol style="list-style-type: decimal">
<li>The component cause of failure <span class="math inline">\(K_i\)</span> for each system <span class="math inline">\(i\)</span>.</li>
<li>The system failure time <span class="math inline">\(T_i\)</span> for each system <span class="math inline">\(i\)</span>.</li>
<li>The component failure time <span class="math inline">\(T_{i K_i}\)</span> for each system <span class="math inline">\(i\)</span>.</li>
<li>Each of the non-failed component failure times <span class="math inline">\(T_{i p}\)</span> for each system <span class="math inline">\(i\)</span> and each component <span class="math inline">\(p \neq K_i\)</span> survived at least until <span class="math inline">\(T_{i \, K_i}\)</span>.</li>
</ol>
<p>We might be tempted to think that we can just consider each observation, where we know the system lifetime and the component cause, and then just estimate the component’s parameter based on its failure time. However, this is incorrect, because when we condition on the component that caused the system failure, we are not observing a random sample of that component’s lifetime, but a conditional sample. For instance, if <span class="math inline">\(k = 1\)</span>, then we are observing <span class="math inline">\(T_{i 1} | T_{i 1} &lt; T_{i 2} \text{ and } T_{i 1} &lt; T_{i 3}\)</span>.</p>
<p>What is this distribution? We can derive it as: <span class="math display">\[
    f_{T_i|K_i}(t_i | k_i) = f_{T_i,K_i}(t_i,k_i) / f_{K_i}(k_i) =
        f_{K_i|T_i}(k_i|t_i) f_{T_i}(t_i) / f_{K_i}(k_i).
\]</span> By the memoryless property of the exponential distribution, we have <span class="math display">\[
    f_{K_i|T_i}(k_i|t_i) = f_{K_i}(k_i),
\]</span> since the failure rates are constant (and thus independent of the time), and thus the probability that a componet is the cause of a system failure is independent of the time of the system failure.</p>
<p>That means that <span class="math display">\[
    f_{T_i|K_i}(t_i | k_i) = f_{T_i}(t_i),
\]</span> which in the exponential case is just the pdf of the series system. Since the minimum of exponentially distributed random variables is exponentially distributed with a falure rate equal to the sum of the failure rates of the components, this estimator is an estimator of the sum of the failure rates (or the failure rate of the series system).</p>
<p>Instead, we just consider this to be a kind of right-censoring problem, where we have <span class="math inline">\(m=3\)</span> components, and thus when component <span class="math inline">\(1\)</span> is the component cause of failure at <span class="math inline">\(t_i\)</span>, that means we observe an exact failure time <span class="math inline">\(T_{i 1} = t_i\)</span> and right-censor the other two components at <span class="math inline">\(t_i\)</span>. The loglikehood contribution for this observation is <span class="math display">\[
    L_i = \log f_1(t_i|\lambda_1) + \log R_2(t_i|\lambda_2) + \log R_3(t_i|\lambda_3),
\]</span> which simplifies to <span class="math display">\[
    L_i = \log \lambda_1 - (\lambda_1 + \lambda_2 + \lambda_3) t_i,
\]</span> which has a score <span class="math display">\[
    s_i = 1 / \lambda_1 - t_i
\]</span> and a Hessian <span class="math display">\[
    H_i = \begin{bmatrix}
        -1 / \lambda_1^2 &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; 0
    \end{bmatrix}.
\]</span></p>
<p>To get the total log-likelihood, score, and Hessian, we just sum them up (by i.i.d.).</p>
<p>In fact, that’s what we do here. We show how to use the likelihood contribution model. We show two ways to configure the model to dispatch the <code>loglik</code> and <code>score</code> functions for the observation type.</p>
<p>We implement methods for the <code>loglik</code> and <code>score</code> functions. This allows dispatching based on the observation type, as defined in <code>obs_type</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">score.observed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">rates</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">n</span> <span class="op">/</span> <span class="va">rates</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">loglik.observed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">rates</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">rates</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model.observed</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/likelihood_contr_model.html">likelihood_contr_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    obs_type <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="st">"observed"</span> <span class="co"># expands to `rep("observed", nrow(df))`</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># letting it dispatch to the right generic method based on the observation</span></span>
<span>    <span class="co"># type is more flexible, but we can also specify it directly here</span></span>
<span>    <span class="co"># this is useful since we can use different models for the same data</span></span>
<span>    <span class="co"># by just changing the likelihood contribution model here. we can do this</span></span>
<span>    <span class="co"># for score and hess_loglik as well</span></span>
<span>    logliks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        observed <span class="op">=</span> <span class="va">loglik.observed</span> <span class="co"># we could have ommited this</span></span>
<span>                                   <span class="co"># we do ommit it for the score function</span></span>
<span>                                   <span class="co"># also, since we can specify any function</span></span>
<span>                                   <span class="co"># here, we are not constrained to any </span></span>
<span>                                   <span class="co"># naming convention, e.g., it could have</span></span>
<span>                                   <span class="co"># been defined inline as</span></span>
<span>                                   <span class="co">#   `observed = function(df, rates, ...) {</span></span>
<span>                                   <span class="co">#      ... }`</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now that we have the likelihood model, we can use it to estimate the parameters. We use the <code>optim</code> function to do the numerical optimization. We use the <code>hessian = TRUE</code> argument to get the Hessian matrix, which we can use to get the standard errors of the estimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="va">rates</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/loglik.html">loglik</a></span><span class="op">(</span><span class="va">model.observed</span><span class="op">)</span>, df <span class="op">=</span> <span class="va">df</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] 1.37 1.26 1.24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] -112</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       66       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Note that <code>likelihood_model</code> objects have a default method for fitting MLEs, <code>fit</code>. Internally, this method uses <code>optim</code> to maximize the log-likelihood, but it packs in some additional information and returns the result as a <code>mle_numerical</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#fitter &lt;- fit(model.observed)</span></span>
<span><span class="co">#fitter(df, par = rates)</span></span></code></pre></div>
<p>We implement <code>hess_loglik.observed</code> for completeness.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(dplyr)</span></span>
<span><span class="va">hess_loglik.observed</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">rates</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span></span>
<span>    <span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">H</span><span class="op">[</span><span class="va">j</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">counts</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">/</span> <span class="va">rates</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">H</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#H &lt;- -algebraic.mle::observed_fim(model.observed)(df, point(mle.observed))</span></span>
<span><span class="co">#H[abs(H) &lt; 1e-3] &lt;- 0</span></span>
<span><span class="co">#print(H)</span></span>
<span><span class="co">#hess_loglik(model.observed)(df, point(mle.observed))</span></span></code></pre></div>
<p>Now, we use the Bootstrap method.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boots</span> <span class="op">&lt;-</span> <span class="fu">sampler</span><span class="op">(</span><span class="va">model.observed</span><span class="op">)</span><span class="op">(</span><span class="va">df</span>, par <span class="op">=</span> <span class="va">rates</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="case-2-right-censoring">Case 2: Right-censoring<a class="anchor" aria-label="anchor" href="#case-2-right-censoring"></a>
</h2>
<p>We add right-censoring to the model. We assume that the right-censoring times are independent of the component lifetimes and the candidate sets.</p>
<p>In prticular, we consider the data described earlier, but with right-censoring at time <span class="math inline">\(\tau = 0.5\)</span>. The presence of this right-censoring means that we know the event occurred after time <span class="math inline">\(\tau\)</span> for these censored observations, but we do not know exactly when (and it may still be ongoing).</p>
<p>As a first stab, you might be inclined to just ignore the censored data. However, this is not a good idea, because it will lead to biased estimates. This is problematic because then we are estimating the parameters of a truncated distribution, <span class="math inline">\(T_i | T_i &lt; \tau\)</span>, rather than the original distribution, <span class="math inline">\(S_i, \tau_i\)</span> where <span class="math inline">\(S_i = T_i\)</span> if <span class="math inline">\(T_i &lt; \tau_i\)</span> and otherwise <span class="math inline">\(S_i = \tau_i\)</span>. This is a well-known problem in statistics, and it is why we need to use <em>survival analysis</em> techniques to handle right-censored data.</p>
<p>This is similiar to the earlier problem we described where we said it was a mistake to only focus on the component cause of failure and estimate the parameters of the components independently. In that case, we would be estimating component <span class="math inline">\(j\)</span>’s parameters from the truncated distribution, <span class="math inline">\(T_{i j} | K_i = j\)</span>, rather than the original distribution, <span class="math inline">\(T_i = \min\{T_{i 1}, \ldots, T_{i m}\}\)</span>. In either case, the censoring or masking mechanisms must not be ignored, otherwise we will get biased estimates.</p>
<p>Here’s what that right-censored data looks like, with right-censoring time of <span class="math inline">\(\tau = 0.5\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if df$t &gt; .5, then the system was right-censored</span></span>
<span><span class="va">df.censored</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    censored <span class="op">=</span> <span class="va">t</span> <span class="op">&gt;</span> <span class="fl">.5</span>,</span>
<span>    t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">censored</span>, <span class="fl">.5</span>, <span class="va">t</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df.censored</span><span class="op">[</span><span class="va">df.censored</span><span class="op">[</span>,<span class="st">"censored"</span><span class="op">]</span>, <span class="st">"k"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">df.censored</span><span class="op">[</span><span class="va">df.censored</span><span class="op">[</span>,<span class="st">"censored"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df.censored</span><span class="op">)</span></span>
<span><span class="co">#&gt;       t1     t2    t3      t k censored</span></span>
<span><span class="co">#&gt; 1     NA 0.3201    NA 0.3201 2    FALSE</span></span>
<span><span class="co">#&gt; 2     NA 0.0449    NA 0.0449 2    FALSE</span></span>
<span><span class="co">#&gt; 3     NA 0.0488    NA 0.0488 2    FALSE</span></span>
<span><span class="co">#&gt; 4 0.0827     NA    NA 0.0827 1    FALSE</span></span>
<span><span class="co">#&gt; 5     NA     NA 0.141 0.1408 3    FALSE</span></span>
<span><span class="co">#&gt; 6 0.0347     NA    NA 0.0347 1    FALSE</span></span></code></pre></div>
<p>We cosntruct their censoring functions with:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loglik.censored</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">rates</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">score.censored</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">rates</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">hess_loglik_censored</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">rates</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model.censored</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/likelihood_contr_model.html">likelihood_contr_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    obs_type <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">censored</span>, <span class="st">"censored"</span>, <span class="st">"observed"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mle.censored</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://queelius.github.io/algebraic.mle/reference/mle_numerical.html" class="external-link">mle_numerical</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span></span>
<span>        <span class="va">rates</span>,</span>
<span>        fn <span class="op">=</span> <span class="fu"><a href="../reference/loglik.html">loglik</a></span><span class="op">(</span><span class="va">model.censored</span><span class="op">)</span>,</span>
<span>        df <span class="op">=</span> <span class="va">df.censored</span>, hessian <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle.censored</span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum likelihood estimator of type mle_numerical is normally distributed.</span></span>
<span><span class="co">#&gt; The estimates of the parameters are given by:</span></span>
<span><span class="co">#&gt; [1] 1.32 1.26 1.20</span></span>
<span><span class="co">#&gt; The standard error is  0.2 0.195 0.19 .</span></span>
<span><span class="co">#&gt; The asymptotic 95% confidence interval of the parameters are given by:</span></span>
<span><span class="co">#&gt;         2.5% 97.5%</span></span>
<span><span class="co">#&gt; param1 0.933  1.72</span></span>
<span><span class="co">#&gt; param2 0.882  1.65</span></span>
<span><span class="co">#&gt; param3 0.831  1.58</span></span>
<span><span class="co">#&gt; The MSE of the individual components in a multivariate estimator is:</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,]  3.98e-02 -5.38e-12 -2.56e-12</span></span>
<span><span class="co">#&gt; [2,] -5.38e-12  3.80e-02 -2.62e-18</span></span>
<span><span class="co">#&gt; [3,] -2.56e-12 -2.63e-18  3.62e-02</span></span>
<span><span class="co">#&gt; The log-likelihood is  -96.4 .</span></span>
<span><span class="co">#&gt; The AIC is  199 .</span></span></code></pre></div>
<p>So, recall the true parameters are <span class="math inline">\(\lambda = 1.1, 1.2, 1.3\)</span>. We can see that the estimates are reasonable, particularly for the relatively small sample size.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Towell.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
